<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="author" title="About these documents" href="about.html" /><link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="📚 API Reference" href="reference/index.html" /><link rel="prev" title="Platform-specific deployment templates" href="generated/notebooks/deployment/deployment03.html" />

    <link rel="shortcut icon" href="_static/favicon.ico"/><!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>🔪 Quirks and Gotchas - Archimedes documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=c2950814" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #D35400;
  --color-brand-content: #C0392B;
  --color-admonition-background: rgba(211, 84, 0, 0.1);
  --color-background-primary: #F5F5F5;
  --color-background-secondary: #EEEEEE;
  --color-foreground-primary: #2A2A2A;
  --color-foreground-secondary: #5D4037;
  --color-link: #C0392B;
  --color-link-hover: #D35400;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #F1C40F;
  --color-brand-content: #D35400;
  --color-admonition-background: rgba(241, 196, 15, 0.1);
  --color-background-primary: #2A2A2A;
  --color-background-secondary: #1A1A1A;
  --color-foreground-primary: #F5F5F5;
  --color-foreground-secondary: #DDDDDD;
  --color-link: #D35400;
  --color-link-hover: #F1C40F;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #F1C40F;
  --color-brand-content: #D35400;
  --color-admonition-background: rgba(241, 196, 15, 0.1);
  --color-background-primary: #2A2A2A;
  --color-background-secondary: #1A1A1A;
  --color-foreground-primary: #F5F5F5;
  --color-foreground-secondary: #DDDDDD;
  --color-link: #D35400;
  --color-link-hover: #F1C40F;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Archimedes  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
    <div class="sidebar-brand-container">
      <img class="sidebar-logo" src="_static/logo.png" alt="Logo"/>
      <div class="sidebar-brand-text">Archimedes</div>
    </div>
  </a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">What is Archimedes?</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Core Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="under-the-hood.html">Under the Hood</a></li>
<li class="toctree-l1"><a class="reference internal" href="pytrees.html">Working with PyTrees</a></li>
<li class="toctree-l1"><a class="reference internal" href="generated/notebooks/control-flow.html">Structured Control Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="generated/notebooks/modular-design.html">Hierarchical Design Patterns</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="notebooks/multirotor/multirotor00.html">Multirotor Dynamics</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Multirotor Dynamics</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="notebooks/multirotor/multirotor01.html">Part 1: Fundamentals of multirotor dynamics</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/multirotor/multirotor02.html">Part 2: Implementation in Archimedes</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/notebooks/multirotor/multirotor03.html">Part 3: Running the model</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/notebooks/multirotor/multirotor04.html">Part 4: Model analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/notebooks/multirotor/multirotor05.html">Part 5: Revisiting the rotor model (optional)</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/multirotor/multirotor06.html">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="notebooks/deployment/deployment00.html">Deploying to Hardware</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Deploying to Hardware</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="generated/notebooks/deployment/deployment01.html">Generating C code</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/notebooks/deployment/deployment02.html">Generating driver code</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/notebooks/deployment/deployment03.html">Platform-specific deployment templates</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">🔪 Quirks and Gotchas</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="reference/index.html">📚 API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of 📚 API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.codegen.html">archimedes.codegen</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.array.html">archimedes.array</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.sym.html">archimedes.sym</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.sym_like.html">archimedes.sym_like</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.zeros.html">archimedes.zeros</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.ones.html">archimedes.ones</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.zeros_like.html">archimedes.zeros_like</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.ones_like.html">archimedes.ones_like</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.eye.html">archimedes.eye</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.scan.html">archimedes.scan</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.switch.html">archimedes.switch</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.vmap.html">archimedes.vmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.compile.html">archimedes.compile</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.callback.html">archimedes.callback</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.grad.html">archimedes.grad</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.jac.html">archimedes.jac</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.hess.html">archimedes.hess</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.jvp.html">archimedes.jvp</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.vjp.html">archimedes.vjp</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.interpolant.html">archimedes.interpolant</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.integrator.html">archimedes.integrator</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.odeint.html">archimedes.odeint</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.nlp_solver.html">archimedes.nlp_solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.minimize.html">archimedes.minimize</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.implicit.html">archimedes.implicit</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.root.html">archimedes.root</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/api/archimedes.qpsol.html">archimedes.qpsol</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="generated/api/archimedes.tree.html">archimedes.tree</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of archimedes.tree</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/api/archimedes.tree.all.html">archimedes.tree.all</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/api/archimedes.tree.flatten.html">archimedes.tree.flatten</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/api/archimedes.tree.leaves.html">archimedes.tree.leaves</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/api/archimedes.tree.map.html">archimedes.tree.map</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/api/archimedes.tree.ravel.html">archimedes.tree.ravel</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/api/archimedes.tree.reduce.html">archimedes.tree.reduce</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/api/archimedes.tree.register_dataclass.html">archimedes.tree.register_dataclass</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/api/archimedes.tree.register_pytree_node.html">archimedes.tree.register_pytree_node</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/api/archimedes.tree.structure.html">archimedes.tree.structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/api/archimedes.tree.unflatten.html">archimedes.tree.unflatten</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="generated/api/archimedes.tree.struct.html">archimedes.tree.struct</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of archimedes.tree.struct</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/api/archimedes.tree.struct.dataclass_transform.html">archimedes.tree.struct.dataclass_transform</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/api/archimedes.tree.struct.field.html">archimedes.tree.struct.field</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/api/archimedes.tree.struct.fields.html">archimedes.tree.struct.fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/api/archimedes.tree.struct.is_pytree_node.html">archimedes.tree.struct.is_pytree_node</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/api/archimedes.tree.struct.pytree_node.html">archimedes.tree.struct.pytree_node</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/api/archimedes.tree.struct.register_dataclass.html">archimedes.tree.struct.register_dataclass</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/api/archimedes.tree.struct.replace.html">archimedes.tree.struct.replace</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/api/archimedes.tree.struct.Any.html">archimedes.tree.struct.Any</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/api/archimedes.tree.struct.Callable.html">archimedes.tree.struct.Callable</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/api/archimedes.tree.struct.InitVar.html">archimedes.tree.struct.InitVar</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/api/archimedes.tree.struct.TypeVar.html">archimedes.tree.struct.TypeVar</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">Development Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="licensing-model.html">Licensing model</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/gotchas.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="quirks-and-gotchas">
<h1>🔪 Quirks and Gotchas<a class="headerlink" href="#quirks-and-gotchas" title="Link to this heading">¶</a></h1>
<p>Archimedes is a Python framework for numerical modeling and simulation that bridges NumPy’s ease of use with the performance benefits of symbolic computation through CasADi.
While it makes complex modeling tasks more approachable, there are several “sharp bits” you should be aware of to avoid unexpected behavior.
This document outlines common pitfalls and quirks you might encounter when using Archimedes.</p>
<p>This page is modeled after <a class="reference external" href="https://docs.jax.dev/en/latest/notebooks/Common_Gotchas_in_JAX.html">“🔪 JAX - The Sharp Bits 🔪”</a>, since JAX and Archimedes share many design features.</p>
<section id="pure-functions">
<h2>Pure Functions<a class="headerlink" href="#pure-functions" title="Link to this heading">¶</a></h2>
<p>Archimedes transformations and compilation is designed to work only with functions that are <em>pure</em>: all input data is passed through the function parameters, and all results are returned through the function return values.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># NOT recommended: impure function that uses a global variable</span>
<span class="n">g</span> <span class="o">=</span> <span class="mf">9.81</span>
<span class="k">def</span><span class="w"> </span><span class="nf">impure_acceleration</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">g</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span> <span class="n">like</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>  <span class="c1"># Uses global g</span>

<span class="c1"># Recommended: pure function with all inputs as parameters</span>
<span class="k">def</span><span class="w"> </span><span class="nf">pure_acceleration</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="mf">9.81</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">g</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span> <span class="n">like</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>  <span class="c1"># g passed as parameter</span>

<span class="c1"># BAD: impure function that modifies a global variable</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">def</span><span class="w"> </span><span class="nf">impure_accumulator</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">i</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># Modifies global i</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">i</span>
</pre></div>
</div>
<p>While Archimedes works with impure functions in simple cases, this can lead to surprising behavior when functions are transformed or reused. For example, if the global variable <code class="docutils literal notranslate"><span class="pre">g</span></code> changes value, the function might still use the original value in some contexts.</p>
<p>Less obviously, print statements are a “side effect” that makes functions impure.
However, it is possible to print from within the compiled computational graph using the <a class="reference internal" href="#callbacks">callback</a> mechanism.
For more tips on printing and debugging see the <a class="reference internal" href="#debugging">debug</a> section below.</p>
</section>
<section id="function-signatures">
<h2>Function signatures<a class="headerlink" href="#function-signatures" title="Link to this heading">¶</a></h2>
<p>Keyword arguments are supported, but all function arguments must be allowed to be either positional or keyword.  In addition, all arguments must be defined explicitly.  That is, the following signatures are valid:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">f1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="nb">compile</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>  <span class="c1"># OK, positional args are supported</span>

<span class="k">def</span><span class="w"> </span><span class="nf">f2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">2.0</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>

<span class="nb">compile</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span>  <span class="c1"># OK, kwargs are supported</span>
</pre></div>
</div>
<p>but positional-only, keyword-only, varargs, etc. are not allowed.  The following signatures are therefore invalid:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">f3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">/</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="nb">compile</span><span class="p">(</span><span class="n">f3</span><span class="p">)</span>  <span class="c1"># Positional-only not allowed</span>

<span class="k">def</span><span class="w"> </span><span class="nf">f4</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">2.0</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>

<span class="nb">compile</span><span class="p">(</span><span class="n">f4</span><span class="p">)</span>  <span class="c1"># Keyword-only not allowed</span>

<span class="k">def</span><span class="w"> </span><span class="nf">f6</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span>

<span class="nb">compile</span><span class="p">(</span><span class="n">f5</span><span class="p">)</span>  <span class="c1"># Variadic args not allowed</span>

<span class="k">def</span><span class="w"> </span><span class="nf">f6</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>

<span class="nb">compile</span><span class="p">(</span><span class="n">f6</span><span class="p">)</span>  <span class="c1"># Variadic kwargs not allowed</span>
</pre></div>
</div>
<p>Note that this requirement only applies to the top-level function that is evaluated symbolically.  So for example, the <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> example <code class="docutils literal notranslate"><span class="pre">f6</span></code> above could be called from another function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">g</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f6</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="n">A</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>

<span class="nb">compile</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>   <span class="c1"># OK, all arguments are defined explicitly at top level</span>
</pre></div>
</div>
</section>
<section id="numpy-compatibility-limitations">
<span id="id1"></span><h2>NumPy Compatibility Limitations<a class="headerlink" href="#numpy-compatibility-limitations" title="Link to this heading">¶</a></h2>
<p>Archimedes currently supports many common NumPy operations, but not all.
To see the exhaustive list and current implementation status, see:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">archimedes._core._array_ops._array_ufunc.SUPPORTED_UFUNCS</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">archimedes._core._array_ops._array_function.SUPPORTED_FUNCTIONS</span></code></p></li>
</ul>
<p>Any entries with <code class="docutils literal notranslate"><span class="pre">NotImplemented</span></code> values are currently not supported.
<strong>If you’d like to see one of these implemented, feel free to file a feature request (or bump an existing one)!</strong></p>
</section>
<section id="matrix-vs-scalar-valued-symbolics">
<h2>Matrix- vs. scalar-valued symbolics<a class="headerlink" href="#matrix-vs-scalar-valued-symbolics" title="Link to this heading">¶</a></h2>
<p>When compiling functions, note that there are two basic symbolic types inherited from CasADi: <code class="docutils literal notranslate"><span class="pre">SX</span></code> and <code class="docutils literal notranslate"><span class="pre">MX</span></code>.
<code class="docutils literal notranslate"><span class="pre">SX</span></code> symbolics create symbolic arrays as a collection of symbolic scalars, while <code class="docutils literal notranslate"><span class="pre">MX</span></code> directly create a single symbol to represent an array.
There are performance and flexibility tradeoffs between the two, and trying to mix them can be error prone.</p>
<p>Specifically, if you get <code class="docutils literal notranslate"><span class="pre">NotImplemented</span></code> errors related to functions that you know are supported (see <a class="reference internal" href="#numpy-compatibility-limitations">above</a>), a likely reason is that you have somehow mixed <code class="docutils literal notranslate"><span class="pre">SX</span></code> and <code class="docutils literal notranslate"><span class="pre">MX</span></code> symbolics.
For more information see the <a class="reference internal" href="under-the-hood.html#symbolic-types"><span class="std std-ref">section on symbolic types</span></a> in Under the Hood.</p>
</section>
<section id="array-dimensions">
<h2>Array Dimensions<a class="headerlink" href="#array-dimensions" title="Link to this heading">¶</a></h2>
<p>In contrast to standard NumPy N-dimensional arrays, CasADi symbolic arrays are always two-dimensional (an artifact of its MATLAB-oriented heritage).
Archimedes allows for 0-D, 1-D, and 2-D arrays to mimic NumPy behavior, but higher-dimensional arrays are currently not supported.</p>
</section>
<section id="array-creation">
<h2>Array Creation<a class="headerlink" href="#array-creation" title="Link to this heading">¶</a></h2>
<p>One of the most common pitfalls in Archimedes involves creating arrays within compiled functions.
This is because of the step where the function arguments are replaced with symbolic arrays; standard NumPy array creation doesn’t automatically work with these symbolic arrays:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This will NOT work with symbolic inputs:</span>
<span class="k">def</span><span class="w"> </span><span class="nf">bad_function</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>  <span class="c1"># NumPy doesn&#39;t know to make SymbolicArrays</span>

<span class="c1"># This will NOT work with symbolic inputs:</span>
<span class="k">def</span><span class="w"> </span><span class="nf">also_bad</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># Creates a NumPy array, not a symbolic array</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># Fails - cannot assign symbolic value to numeric array</span>
    <span class="k">return</span> <span class="n">y</span>
</pre></div>
</div>
<p>Instead, you must explicitly use <code class="docutils literal notranslate"><span class="pre">like=</span></code> parameter, dispatched functions, or Archimedes array constructors:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Good: use like= to create compatible arrays</span>
<span class="k">def</span><span class="w"> </span><span class="nf">good_function1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">like</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Good: use dispatched functions like hstack, vstack, etc.</span>
<span class="k">def</span><span class="w"> </span><span class="nf">good_function2</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

<span class="c1"># Good: use Archimedes array constructor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">archimedes</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">arc</span>
<span class="k">def</span><span class="w"> </span><span class="nf">good_function3</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">arc</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

<span class="c1"># Good: use zeros_like and other dispatched functions</span>
<span class="k">def</span><span class="w"> </span><span class="nf">good_function4</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">y</span>

<span class="c1"># Good: use Archimedes zeros and similar functions</span>
<span class="k">def</span><span class="w"> </span><span class="nf">good_function4</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">arc</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">y</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you get the error <code class="docutils literal notranslate"><span class="pre">ValueError:</span> <span class="pre">setting</span> <span class="pre">an</span> <span class="pre">array</span> <span class="pre">element</span> <span class="pre">with</span> <span class="pre">a</span> <span class="pre">sequence.</span> <span class="pre">The</span> <span class="pre">requested</span> <span class="pre">array</span> <span class="pre">would</span> <span class="pre">exceed</span> <span class="pre">the</span> <span class="pre">maximum</span> <span class="pre">number</span> <span class="pre">of</span> <span class="pre">dimension</span> <span class="pre">of</span> <span class="pre">64.</span></code> this is most likely due to incorrect array creation.</p>
</div>
</section>
<section id="control-flow">
<h2>Control Flow<a class="headerlink" href="#control-flow" title="Link to this heading">¶</a></h2>
<p>Python’s standard control flow constructs like <code class="docutils literal notranslate"><span class="pre">if/else</span></code> and loops with dynamic bounds don’t work well with symbolic evaluation. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This will NOT work correctly when x is symbolic</span>
<span class="nd">@arc</span><span class="o">.</span><span class="n">compile</span>
<span class="k">def</span><span class="w"> </span><span class="nf">bad_conditional</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Can&#39;t evaluate symbolic expression in boolean context</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>Instead, use <code class="docutils literal notranslate"><span class="pre">np.where</span></code> for conditionals:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@arc</span><span class="o">.</span><span class="n">compile</span>
<span class="k">def</span><span class="w"> </span><span class="nf">good_conditional</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<p>For loops:</p>
<ol class="arabic simple">
<li><p>Ensure loop bounds are static (not symbolic expressions)</p></li>
<li><p>Consider using <code class="docutils literal notranslate"><span class="pre">arc.scan</span></code> for more complex loops</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This will NOT work with symbolic input</span>
<span class="nd">@arc</span><span class="o">.</span><span class="n">compile</span>
<span class="k">def</span><span class="w"> </span><span class="nf">bad_loop</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>  <span class="c1"># sum(x) is symbolic, can&#39;t be used as loop bound</span>
        <span class="n">y</span> <span class="o">+=</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">y</span>

<span class="c1"># This will work</span>
<span class="nd">@arc</span><span class="o">.</span><span class="n">compile</span>
<span class="k">def</span><span class="w"> </span><span class="nf">good_loop</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>  <span class="c1"># Fixed shape is fine</span>
        <span class="n">y</span> <span class="o">+=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">y</span>
</pre></div>
</div>
<p>See the <a class="reference internal" href="getting-started.html#control-flow"><span class="std std-ref">control flow</span></a>  section of Getting Started for a simple example with <code class="docutils literal notranslate"><span class="pre">scan</span></code>, or see the <code class="docutils literal notranslate"><span class="pre">scan</span></code> API documentation for details.</p>
</section>
<section id="static-arguments">
<h2>Static Arguments<a class="headerlink" href="#static-arguments" title="Link to this heading">¶</a></h2>
<p>Some function arguments shouldn’t be traced symbolically, but instead treated as fixed configuration parameters. Archimedes provides a way to specify these:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@arc</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">static_argnames</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;apply_bc&quot;</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">solve_with_optional_bc</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">apply_bc</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">apply_bc</span><span class="p">:</span>  <span class="c1"># This works because apply_bc is static</span>
        <span class="n">b</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># Apply boundary conditions</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
<p>When a function with static arguments is called, it will be retraced whenever the static argument value changes. This allows conditional evaluation based on configuration, but can lead to performance issues if done excessively.</p>
</section>
<section id="function-caching">
<h2>Function Caching<a class="headerlink" href="#function-caching" title="Link to this heading">¶</a></h2>
<p>“Compiled” functions in Archimedes are cached based on the shapes and dtypes of their arguments, as well as on the values of static parameters. This means the first call to a function with a specific argument shape might be slower (due to tracing), but subsequent calls with the same shape will be faster.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@arc</span><span class="o">.</span><span class="n">compile</span>
<span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">f</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]))</span>  <span class="c1"># First trace with shape (2,)</span>
<span class="n">f</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]))</span>  <span class="c1"># Reuse cached function for shape (2,)</span>
<span class="n">f</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]))</span>  <span class="c1"># New trace with shape (3,)</span>
</pre></div>
</div>
<p>Be aware that excessive retracing with different argument shapes can lead to performance degradation and memory usage growth.</p>
</section>
<section id="in-place-operations">
<span id="id2"></span><h2>In-place Operations<a class="headerlink" href="#in-place-operations" title="Link to this heading">¶</a></h2>
<p>Unlike NumPy, which allows in-place modification of arrays, symbolic arrays in Archimedes should be treated as immutable. Operations that appear to modify arrays in-place in Python actually create new symbolic expressions behind the scenes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># In NumPy - modifies array in place</span>
<span class="n">numpy_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">numpy_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Original array is modified</span>

<span class="c1"># In Archimedes - creates new symbolic expression</span>
<span class="nd">@arc</span><span class="o">.</span><span class="n">compile</span>
<span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># This doesn&#39;t actually modify x in-place when symbolic</span>
    <span class="k">return</span> <span class="n">x</span>    <span class="c1"># Instead, it creates a new expression</span>

<span class="c1"># When using arc.compile, this becomes pure even if the Python code isn&#39;t!</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># [0., 0., 0.] - original is unchanged</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>  <span class="c1"># [1., 0., 0.] - new array is returned</span>
</pre></div>
</div>
<p>This behavior differs from both NumPy (which modifies arrays in-place) and JAX (which disallows in-place operations entirely).</p>
<p>The current recommendation is that it is okay to do in-place operations, but do it with caution.
Specifically, it is a good idea when implementing a function like this to always decorate it so that there is not a “NumPy version” that may inadvertently behave differently than the “Archimedes version”.</p>
</section>
<section id="calling-external-code">
<span id="callbacks"></span><h2>Calling external code<a class="headerlink" href="#calling-external-code" title="Link to this heading">¶</a></h2>
<p>It is possible to embed arbitrary Python code inside of a compiled function using the :py:func:<code class="docutils literal notranslate"><span class="pre">callback</span></code> mechanism.
All that is required is to specify the shape and data type of the output of your function so that a node for the computational graph can be created with the right output type.</p>
<p>Here is a simple example using an operation that does not have symbolic support (estimating power spectral density using Welch’s method); if a function like this needs to be called from within an Archimedes function it can be done as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">signal</span>

<span class="k">def</span><span class="w"> </span><span class="nf">calc_sum_psd</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="c1"># Computation that is not supported symbolically</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">Pxx</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">welch</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">Pxx</span><span class="p">[</span><span class="n">f</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">])</span>

<span class="c1"># Call from within a compiled function</span>
<span class="nd">@arc</span><span class="o">.</span><span class="n">compile</span>
<span class="k">def</span><span class="w"> </span><span class="nf">sum_psd</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">result_shape_dtypes</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># Template data type for output (float)</span>
    <span class="k">return</span> <span class="n">arc</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">calc_sum_psd</span><span class="p">,</span> <span class="n">result_shape_dtypes</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sum_psd</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>  <span class="c1"># 0.010448377825162803</span>
</pre></div>
</div>
<p>This is useful for calling legacy code, non-NumPy calculations, and for printing output as a debugging tactic (more on this <a class="reference internal" href="#debugging">next</a>).</p>
<p>Note that the callback code is not guaranteed to execute unless there is a non-empty return value; when doing “dummy” operations like printing it is recommended to just return the inputs directly.</p>
</section>
<section id="debugging-symbolic-code">
<span id="debugging"></span><h2>Debugging Symbolic Code<a class="headerlink" href="#debugging-symbolic-code" title="Link to this heading">¶</a></h2>
<p>Debugging symbolic code can be challenging because:</p>
<ol class="arabic simple">
<li><p>Error messages may refer to CasADi internals rather than your code</p></li>
<li><p>Standard Python debuggers can’t step through symbolically evaluated code</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">print</span></code> statements in compiled functions won’t execute at runtime</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@arc</span><span class="o">.</span><span class="n">compile</span>
<span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This won&#39;t print during symbolic tracing&quot;</span><span class="p">)</span>  <span class="c1"># Won&#39;t execute during tracing</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span> <span class="o">*</span> <span class="mi">2</span>

<span class="c1"># Instead, debug the inputs and outputs:</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Input:&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Output:&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>Some tips for debugging:</p>
<ul class="simple">
<li><p>Print array shapes and dtypes instead of values at trace time</p></li>
<li><p>Add trace/debug prints before and after compiled function calls</p></li>
<li><p>Split complex operations into smaller, testable pieces</p></li>
<li><p>Test with concrete numeric values before compiling</p></li>
</ul>
<p>A reliable workflow is to write small functions in pure NumPy first, validate the NumPy code, and then add the <code class="docutils literal notranslate"><span class="pre">compile</span></code> decorator once you’re confident in the results.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Aside from specific cases like <a class="reference internal" href="#in-place-operations">in-place operations</a>, Archimedes and NumPy results should be consistent.
If you are seeing unexpected divergences, <strong>please file a bug report.</strong></p>
</div>
<p>It is possible to print from within a compiled function using the <a class="reference internal" href="#callbacks">callback mechanism</a> described above.  For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="k">def</span><span class="w"> </span><span class="nf">print_func</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Value: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">y</span>

<span class="c1"># A compiled function that uses the print functionality</span>
<span class="nd">@arc</span><span class="o">.</span><span class="n">compile</span>
<span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">arc</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">print_func</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># prints &quot;Value: [0.84147098 0.90929743 0.14112001]&quot;</span>
</pre></div>
</div>
<p>Note that the callback code is not guaranteed to execute unless there is a non-empty return value.
The pattern shown here of returning any arguments used for printing is a simple workaround.</p>
</section>
<section id="symbolic-vs-numeric-interface-differences">
<h2>Symbolic vs. Numeric Interface Differences<a class="headerlink" href="#symbolic-vs-numeric-interface-differences" title="Link to this heading">¶</a></h2>
<p>While Archimedes tries to make symbolic and numeric functions behave identically, there are some unavoidable differences:</p>
<ol class="arabic simple">
<li><p>Compiled functions can’t use arbitrary Python objects as inputs - stick to numeric values and arrays, or PyTree data structures that Archimedes knows how to work with</p></li>
<li><p>Some NumPy functions may have subtly different behavior in symbolic vs. numeric contexts (e.g. <a class="reference internal" href="#in-place-operations">in-place operations</a>)</p></li>
<li><p>Not all NumPy functionality is available symbolically.  <strong>If you find a missing function you need, feel free to file a feature request (or bump an existing one)</strong>.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Works in both contexts</span>
<span class="k">def</span><span class="w"> </span><span class="nf">simple_function</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Works only in numeric context</span>
<span class="k">def</span><span class="w"> </span><span class="nf">complex_function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">callback</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>  <span class="c1"># Can&#39;t symbolically trace an arbitrary callback</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="c1"># Works IF the callback is hashable</span>
<span class="n">traced_function</span> <span class="o">=</span> <span class="n">arc</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">complex_function</span><span class="p">,</span> <span class="n">static_argnames</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;callback&quot;</span><span class="p">,))</span>
</pre></div>
</div>
</section>
<section id="pytree-handling">
<h2>PyTree Handling<a class="headerlink" href="#pytree-handling" title="Link to this heading">¶</a></h2>
<p>While PyTrees provide a powerful way to handle nested data structures, they come with their own quirks:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Be careful when flattening and unflattening complex structures</span>
<span class="n">nested_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]),</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.0</span><span class="p">])}}</span>
<span class="n">flat</span><span class="p">,</span> <span class="n">unflatten</span> <span class="o">=</span> <span class="n">arc</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">nested_data</span><span class="p">)</span>

<span class="c1"># The flat array contains all numeric values concatenated</span>
<span class="nb">print</span><span class="p">(</span><span class="n">flat</span><span class="p">)</span>  <span class="c1"># [1. 2. 3.]</span>

<span class="c1"># When modifying flat array, make sure the shape is preserved</span>
<span class="n">modified</span> <span class="o">=</span> <span class="n">flat</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">restored</span> <span class="o">=</span> <span class="n">unflatten</span><span class="p">(</span><span class="n">modified</span><span class="p">)</span>  <span class="c1"># This works because shape is preserved</span>

<span class="c1"># This would fail because the shape changes</span>
<span class="c1">#larger = np.concatenate([flat, np.array([4.0])])</span>
<span class="c1">#broken = unflatten(larger)  # Error: incompatible flat array shape</span>
</pre></div>
</div>
</section>
<section id="ode-solving-intricacies">
<h2>ODE Solving Intricacies<a class="headerlink" href="#ode-solving-intricacies" title="Link to this heading">¶</a></h2>
<p>When using ODE solvers, be aware of:</p>
<ol class="arabic simple">
<li><p>The dynamics function signature must match the expected format (t, x, *args)</p></li>
<li><p>Integrator state must be a flat vector (use PyTree operations to flatten/unflatten if not)</p></li>
<li><p>In order to maintain static array sizes, ODE solvers can only output data at fixed sample times</p></li>
</ol>
<p>For best performance, create an integrator once and reuse it with different inputs:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Less efficient: recreates the integrator for every call</span>
<span class="k">def</span><span class="w"> </span><span class="nf">simulate_multiple</span><span class="p">(</span><span class="n">initial_conditions</span><span class="p">,</span> <span class="n">t_eval</span><span class="p">):</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">t_span</span> <span class="o">=</span> <span class="p">(</span><span class="n">t_eval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_eval</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">x0</span> <span class="ow">in</span> <span class="n">initial_conditions</span><span class="p">:</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">arc</span><span class="o">.</span><span class="n">odeint</span><span class="p">(</span><span class="n">dynamics</span><span class="p">,</span> <span class="n">t_span</span><span class="o">=</span><span class="n">t_span</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span> <span class="n">t_eval</span><span class="o">=</span><span class="n">t_eval</span><span class="p">)</span>  <span class="c1"># New integrator each time</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span>

<span class="c1"># More efficient: create integrator once</span>
<span class="k">def</span><span class="w"> </span><span class="nf">simulate_multiple_efficient</span><span class="p">(</span><span class="n">initial_conditions</span><span class="p">,</span> <span class="n">t_eval</span><span class="p">):</span>
    <span class="n">solver</span> <span class="o">=</span> <span class="n">arc</span><span class="o">.</span><span class="n">integrator</span><span class="p">(</span><span class="n">dynamics</span><span class="p">,</span> <span class="n">t_eval</span><span class="o">=</span><span class="n">t_eval</span><span class="p">)</span>  <span class="c1"># Create once</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x0</span> <span class="ow">in</span> <span class="n">initial_conditions</span><span class="p">:</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>  <span class="c1"># Reuse solver with different initial conditions</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span>
</pre></div>
</div>
<p>If the dynamics function has additional arguments, the <code class="docutils literal notranslate"><span class="pre">solver</span></code> function will have the signature <code class="docutils literal notranslate"><span class="pre">solver(x0,</span> <span class="pre">*args)</span></code>.
See the API documentation for <code class="docutils literal notranslate"><span class="pre">integrator</span></code> for details.</p>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading">¶</a></h2>
<p>Archimedes can be helpful for improving the performance and functionality of scientific computing work, but it does have its share of sharp edges.
Some of these may be resolved with further development, but some are due to the nature of the symbolic-numeric computing paradigm.
By understanding these quirks and adopting the recommended patterns, you can avoid common pitfalls and build robust, high-performance numerical applications.</p>
<p>If you find yourself struggling with an issue not covered here, the best approach is to:</p>
<ol class="arabic simple">
<li><p>Simplify your code to isolate the problem</p></li>
<li><p>Check if your functions are pure</p></li>
<li><p>Ensure array creation is handled correctly</p></li>
<li><p>Verify control flow is compatible with symbolic evaluation</p></li>
</ol>
<p>If you’ve done all of this and can’t resolve your problem, consider filing an issue on GitHub, particularly if:</p>
<ul class="simple">
<li><p>The NumPy and Archimedes versions of the same function don’t produce the same output</p></li>
<li><p>Archimedes is producing a hard-to-understand error message</p></li>
<li><p>You suspect a bug in the Archimedes code</p></li>
</ul>
<p>Remember that Archimedes is under active development, and the API may evolve to address these and other challenges.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="reference/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">📚 API Reference</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="generated/notebooks/deployment/deployment03.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Platform-specific deployment templates</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Pine Tree Labs, LLC
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">🔪 Quirks and Gotchas</a><ul>
<li><a class="reference internal" href="#pure-functions">Pure Functions</a></li>
<li><a class="reference internal" href="#function-signatures">Function signatures</a></li>
<li><a class="reference internal" href="#numpy-compatibility-limitations">NumPy Compatibility Limitations</a></li>
<li><a class="reference internal" href="#matrix-vs-scalar-valued-symbolics">Matrix- vs. scalar-valued symbolics</a></li>
<li><a class="reference internal" href="#array-dimensions">Array Dimensions</a></li>
<li><a class="reference internal" href="#array-creation">Array Creation</a></li>
<li><a class="reference internal" href="#control-flow">Control Flow</a></li>
<li><a class="reference internal" href="#static-arguments">Static Arguments</a></li>
<li><a class="reference internal" href="#function-caching">Function Caching</a></li>
<li><a class="reference internal" href="#in-place-operations">In-place Operations</a></li>
<li><a class="reference internal" href="#calling-external-code">Calling external code</a></li>
<li><a class="reference internal" href="#debugging-symbolic-code">Debugging Symbolic Code</a></li>
<li><a class="reference internal" href="#symbolic-vs-numeric-interface-differences">Symbolic vs. Numeric Interface Differences</a></li>
<li><a class="reference internal" href="#pytree-handling">PyTree Handling</a></li>
<li><a class="reference internal" href="#ode-solving-intricacies">ODE Solving Intricacies</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>