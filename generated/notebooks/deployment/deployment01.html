<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="author" title="About these documents" href="../../../about.html" /><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><link rel="next" title="Generating driver code" href="deployment02.html" /><link rel="prev" title="Deploying to Hardware" href="../../../notebooks/deployment/deployment00.html" />

    <link rel="shortcut icon" href="../../../_static/favicon.ico"/><!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>Generating C code - Archimedes documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=c2950814" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #D35400;
  --color-brand-content: #C0392B;
  --color-admonition-background: rgba(211, 84, 0, 0.1);
  --color-background-primary: #F5F5F5;
  --color-background-secondary: #EEEEEE;
  --color-foreground-primary: #2A2A2A;
  --color-foreground-secondary: #5D4037;
  --color-link: #C0392B;
  --color-link-hover: #D35400;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #F1C40F;
  --color-brand-content: #D35400;
  --color-admonition-background: rgba(241, 196, 15, 0.1);
  --color-background-primary: #2A2A2A;
  --color-background-secondary: #1A1A1A;
  --color-foreground-primary: #F5F5F5;
  --color-foreground-secondary: #DDDDDD;
  --color-link: #D35400;
  --color-link-hover: #F1C40F;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #F1C40F;
  --color-brand-content: #D35400;
  --color-admonition-background: rgba(241, 196, 15, 0.1);
  --color-background-primary: #2A2A2A;
  --color-background-secondary: #1A1A1A;
  --color-foreground-primary: #F5F5F5;
  --color-foreground-secondary: #DDDDDD;
  --color-link: #D35400;
  --color-link-hover: #F1C40F;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">Archimedes  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
    <div class="sidebar-brand-container">
      <img class="sidebar-logo" src="../../../_static/logo.png" alt="Logo"/>
      <div class="sidebar-brand-text">Archimedes</div>
    </div>
  </a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">What is Archimedes?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Core Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../under-the-hood.html">Under the Hood</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pytrees.html">Working with PyTrees</a></li>
<li class="toctree-l1"><a class="reference internal" href="../control-flow.html">Structured Control Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modular-design.html">Hierarchical Design Patterns</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../notebooks/multirotor/multirotor00.html">Multirotor Dynamics</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Multirotor Dynamics</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../notebooks/multirotor/multirotor01.html">Part 1: Fundamentals of multirotor dynamics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notebooks/multirotor/multirotor02.html">Part 2: Implementation in Archimedes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multirotor/multirotor03.html">Part 3: Running the model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multirotor/multirotor04.html">Part 4: Model analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multirotor/multirotor05.html">Part 5: Revisiting the rotor model (optional)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notebooks/multirotor/multirotor06.html">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../../notebooks/deployment/deployment00.html">Deploying to Hardware</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Deploying to Hardware</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Generating C code</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment02.html">Generating driver code</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment03.html">Platform-specific deployment templates</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../gotchas.html">🔪 Quirks and Gotchas</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../reference/index.html">📚 API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of 📚 API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.codegen.html">archimedes.codegen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.array.html">archimedes.array</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.sym.html">archimedes.sym</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.sym_like.html">archimedes.sym_like</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.zeros.html">archimedes.zeros</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.ones.html">archimedes.ones</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.zeros_like.html">archimedes.zeros_like</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.ones_like.html">archimedes.ones_like</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.eye.html">archimedes.eye</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.scan.html">archimedes.scan</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.switch.html">archimedes.switch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.vmap.html">archimedes.vmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.compile.html">archimedes.compile</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.callback.html">archimedes.callback</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.grad.html">archimedes.grad</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.jac.html">archimedes.jac</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.hess.html">archimedes.hess</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.jvp.html">archimedes.jvp</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.vjp.html">archimedes.vjp</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.interpolant.html">archimedes.interpolant</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.integrator.html">archimedes.integrator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.odeint.html">archimedes.odeint</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.nlp_solver.html">archimedes.nlp_solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.minimize.html">archimedes.minimize</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.implicit.html">archimedes.implicit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.root.html">archimedes.root</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/archimedes.qpsol.html">archimedes.qpsol</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/archimedes.tree.html">archimedes.tree</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of archimedes.tree</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/archimedes.tree.all.html">archimedes.tree.all</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/archimedes.tree.flatten.html">archimedes.tree.flatten</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/archimedes.tree.leaves.html">archimedes.tree.leaves</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/archimedes.tree.map.html">archimedes.tree.map</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/archimedes.tree.ravel.html">archimedes.tree.ravel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/archimedes.tree.reduce.html">archimedes.tree.reduce</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/archimedes.tree.register_dataclass.html">archimedes.tree.register_dataclass</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/archimedes.tree.register_pytree_node.html">archimedes.tree.register_pytree_node</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/archimedes.tree.structure.html">archimedes.tree.structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/archimedes.tree.unflatten.html">archimedes.tree.unflatten</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/archimedes.tree.struct.html">archimedes.tree.struct</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of archimedes.tree.struct</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/archimedes.tree.struct.dataclass_transform.html">archimedes.tree.struct.dataclass_transform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/archimedes.tree.struct.field.html">archimedes.tree.struct.field</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/archimedes.tree.struct.fields.html">archimedes.tree.struct.fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/archimedes.tree.struct.is_pytree_node.html">archimedes.tree.struct.is_pytree_node</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/archimedes.tree.struct.pytree_node.html">archimedes.tree.struct.pytree_node</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/archimedes.tree.struct.register_dataclass.html">archimedes.tree.struct.register_dataclass</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/archimedes.tree.struct.replace.html">archimedes.tree.struct.replace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/archimedes.tree.struct.Any.html">archimedes.tree.struct.Any</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/archimedes.tree.struct.Callable.html">archimedes.tree.struct.Callable</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/archimedes.tree.struct.InitVar.html">archimedes.tree.struct.InitVar</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/archimedes.tree.struct.TypeVar.html">archimedes.tree.struct.TypeVar</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../roadmap.html">Development Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../licensing-model.html">Licensing model</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../../../_sources/generated/notebooks/deployment/deployment01.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ruff: noqa: N802, N803, N806, N815, N816</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">signal</span>

<span class="c1"># Simple utilities for displaying generated code in the notebook</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">display_text</span><span class="p">,</span> <span class="n">extract_c_function</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">archimedes</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">arc</span>

<span class="n">THEME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ARCHIMEDES_THEME&quot;</span><span class="p">,</span> <span class="s2">&quot;dark&quot;</span><span class="p">)</span>
<span class="n">arc</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">THEME</span><span class="p">)</span>
</pre></div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="generating-c-code">
<h1>Generating C code<a class="headerlink" href="#generating-c-code" title="Link to this heading">¶</a></h1>
<p>The first step on the road to deployment is understanding the process of translating your Python logic into C code.</p>
<section id="python-implementation">
<h2>Python implementation<a class="headerlink" href="#python-implementation" title="Link to this heading">¶</a></h2>
<p>First, let’s write our Python function.  In this example we’ll be working with an “infinite impulse response” (IIR) filter in the form of a difference equation:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[
y_n = \sum_{i=0}^{N_n} b_i u_{n-i} - \sum_{i=1}^{N_d} a_i y_{n-i}
\]</div>
</div>
<p>In short, an IIR filter is a type of digital filter where the current output depends on both current and past inputs <em>and</em> past outputs.
This “feedback” property gives IIR filters powerful frequency response characteristics with relatively few coefficients, making them efficient for embedded systems.</p>
<p>The idea is that we can use Python ecosystem tools like <code class="docutils literal notranslate"><span class="pre">scipy.signal</span></code> for filter design and testing on reference signals, and then quickly deploy updated filters to a microcontroller.</p>
<p>Here’s a basic implementation of the IIR difference equation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@arc</span><span class="o">.</span><span class="n">compile</span>
<span class="k">def</span><span class="w"> </span><span class="nf">iir_filter</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">u_prev</span><span class="p">,</span> <span class="n">y_prev</span><span class="p">):</span>
    <span class="c1"># Update input history</span>
    <span class="n">u_prev</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">u_prev</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">u_prev</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span>

    <span class="c1"># Compute output using the direct II transposed structure</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">u_prev</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">y_prev</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">/</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Update output history</span>
    <span class="n">y_prev</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">y_prev</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">y_prev</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>

    <span class="k">return</span> <span class="n">u_prev</span><span class="p">,</span> <span class="n">y_prev</span>
</pre></div>
</div>
<p>There are a couple of things to note about this implementation.</p>
<ul class="simple">
<li><p>It does not hardcode any values for the length of the arrays (filter order)</p></li>
<li><p>It is “functionally pure”, meaning that all outputs are direct functions of the inputs</p></li>
</ul>
<p><strong>Functional purity</strong> is crucial for code generation. In a pure function:</p>
<ul class="simple">
<li><p>The same inputs always produce the same outputs</p></li>
<li><p>No “side effects” occur (like modifying global variables or external state)</p></li>
<li><p>All data transformations are explicitly captured in the inputs and outputs</p></li>
</ul>
<p>This property allows Archimedes to correctly trace the computational flow and generate equivalent C code without unexpected behaviors.
State changes that could otherwise be handled via side effects in imperative code must be explicitly returned as outputs and fed back as inputs in subsequent calls.</p>
<p>Writing it to be general regardless of array length means we can experiment with different filter orders without rewriting any C code.  The pure form allows the function to be traced symbolically (since there are no side effects) and also means the function mimics the logic that the C code will follow in order to pre-allocate all memory.</p>
<p>This is an important potentially counterintuitive point; typically when optimizing pure NumPy code you might pre-allocate “buffer” arrays to avoid as much dynamic memory allocation as possible.  With Archimedes, you do not need to (and in fact cannot) do this.  Instead, the code generation system determines memory handling for you.  We’ll see what this looks like shortly.  This helps to separate the mathematical logic of a function from its implementation details.</p>
<p>Next we can use SciPy’s tools to design filter coefficients:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dt</span> <span class="o">=</span> <span class="mf">0.01</span>  <span class="c1"># Sampling time [seconds]</span>
<span class="n">Wn</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># Cutoff frequency [Hz]</span>
<span class="n">order</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">Wn</span><span class="p">,</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="n">dt</span><span class="p">)</span>

<span class="c1"># Plot the frequency response</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Wn</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="n">dt</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">h</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency [Hz]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Magnitude [dB]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Frequency Response&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../../../_images/deployment01_5_0.png" class="only-light" src="../../../_images/deployment01_5_0.png" />
<img alt="../../../_images/deployment01_5_0_dark.png" class="only-dark" src="../../../_images/deployment01_5_0_dark.png" />
<p>Before proceeding with code generation, it is wise to check that the Python function does what it is intended to.  In this case we can compare the step response as calculated by <code class="docutils literal notranslate"><span class="pre">iir_filter</span></code> to the one calculated by <code class="docutils literal notranslate"><span class="pre">scipy.signal.lfilter</span></code>.  If these match, we can be confident that our code is working properly.  More generally, you might want to implement some simulation code and a set of unit tests to comprehensively test your Python code before converting to C.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply the IIR filter to a step input</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>

<span class="n">u_prev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
<span class="n">y_prev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
    <span class="n">u_prev</span><span class="p">,</span> <span class="n">y_prev</span> <span class="o">=</span> <span class="n">iir_filter</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">u_prev</span><span class="p">,</span> <span class="n">y_prev</span><span class="p">)</span>
    <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_prev</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># SciPy filter function</span>
<span class="n">y_sp</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">lfilter</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Step response matches:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_sp</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Archimedes&quot;</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y_sp</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;SciPy&quot;</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time [s]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Output [-]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Step Response&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Step response matches: True
</pre></div>
</div>
<img alt="../../../_images/deployment01_7_1.png" class="only-light" src="../../../_images/deployment01_7_1.png" />
<img alt="../../../_images/deployment01_7_1_dark.png" class="only-dark" src="../../../_images/deployment01_7_1_dark.png" />
</section>
<section id="converting-to-c-code">
<h2>Converting to C code<a class="headerlink" href="#converting-to-c-code" title="Link to this heading">¶</a></h2>
<p>Once we’ve written a symbolically-compiled Python function, it’s easy to generate corresponding C code using the <a class="reference internal" href="../../api/archimedes.codegen.html#archimedes.codegen" title="archimedes.codegen"><span class="xref myst py py-func"><code class="docutils literal notranslate"><span class="pre">codegen</span></code></span></a> function.
Besides the function to generate code for and the target filename (with a “.c” extension), <code class="docutils literal notranslate"><span class="pre">codegen</span></code> requires “template” arguments that are used to determine the size of all inputs, outputs, and intermediate results in the function.
When translating the Python to C code as in this example, the actual values of these template arguments aren’t used.
In the next part of the tutorial we’ll see where the values come in.</p>
<p>There are a number of other options that can be used to configure the generated code, such as:</p>
<ul class="simple">
<li><p>The data type used for floating-point numbers (defaults to “double”)</p></li>
<li><p>The data type used for integers (defaults to “long long int”)</p></li>
<li><p>Whether to generate C or C++ code (default: C)</p></li>
<li><p>Whether to generate a header file (default: True)</p></li>
<li><p>The number of spaces used for indentation of the generated code (default: 4)</p></li>
</ul>
<p>See the <a class="reference internal" href="../../api/archimedes.codegen.html#archimedes.codegen" title="archimedes.codegen"><span class="xref myst py py-func">documentation</span></a> for more details on how to configure code generation.</p>
<p>There are also two optional arguments to codegen named <code class="docutils literal notranslate"><span class="pre">driver</span></code> and <code class="docutils literal notranslate"><span class="pre">driver_config</span></code>; we’ll get to these in the next part when we begin generating “driver” codes for the C function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create &quot;template&quot; arguments for type inference</span>
<span class="n">u</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">u_prev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
<span class="n">y_prev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">u_prev</span><span class="p">,</span> <span class="n">y_prev</span><span class="p">)</span>

<span class="n">arc</span><span class="o">.</span><span class="n">codegen</span><span class="p">(</span><span class="n">iir_filter</span><span class="p">,</span> <span class="s2">&quot;iir_filter.c&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p>This will generate two files: <code class="docutils literal notranslate"><span class="pre">iir_filter.c</span></code> and a corresponding header file <code class="docutils literal notranslate"><span class="pre">iir_header.h</span></code>.  The parts of the generated code that are intended to be used directly are enumerated in the header file - let’s take a look.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;iir_filter.h&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">c_code</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">display_text</span><span class="p">(</span><span class="n">c_code</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* This file was automatically generated by CasADi 3.6.7.</span>
<span class="cm"> *  It consists of: </span>
<span class="cm"> *   1) content generated by CasADi runtime: not copyrighted</span>
<span class="cm"> *   2) template code copied from CasADi source: permissively licensed (MIT-0)</span>
<span class="cm"> *   3) user code: owned by the user</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="cp">#ifdef __cplusplus</span>
<span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef casadi_real</span>
<span class="cp">#define casadi_real double</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef casadi_int</span>
<span class="cp">#define casadi_int long long int</span>
<span class="cp">#endif</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">iir_filter</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">casadi_real</span><span class="o">**</span><span class="w"> </span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="n">casadi_real</span><span class="o">**</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">casadi_int</span><span class="o">*</span><span class="w"> </span><span class="n">iw</span><span class="p">,</span><span class="w"> </span><span class="n">casadi_real</span><span class="o">*</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">mem</span><span class="p">);</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">iir_filter_alloc_mem</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">iir_filter_init_mem</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">mem</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">iir_filter_free_mem</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">mem</span><span class="p">);</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">iir_filter_checkout</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">iir_filter_release</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">mem</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">iir_filter_incref</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">iir_filter_decref</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="n">casadi_int</span><span class="w"> </span><span class="nf">iir_filter_n_in</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="n">casadi_int</span><span class="w"> </span><span class="nf">iir_filter_n_out</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="n">casadi_real</span><span class="w"> </span><span class="nf">iir_filter_default_in</span><span class="p">(</span><span class="n">casadi_int</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="nf">iir_filter_name_in</span><span class="p">(</span><span class="n">casadi_int</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="nf">iir_filter_name_out</span><span class="p">(</span><span class="n">casadi_int</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">casadi_int</span><span class="o">*</span><span class="w"> </span><span class="nf">iir_filter_sparsity_in</span><span class="p">(</span><span class="n">casadi_int</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">casadi_int</span><span class="o">*</span><span class="w"> </span><span class="nf">iir_filter_sparsity_out</span><span class="p">(</span><span class="n">casadi_int</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">iir_filter_work</span><span class="p">(</span><span class="n">casadi_int</span><span class="w"> </span><span class="o">*</span><span class="n">sz_arg</span><span class="p">,</span><span class="w"> </span><span class="n">casadi_int</span><span class="o">*</span><span class="w"> </span><span class="n">sz_res</span><span class="p">,</span><span class="w"> </span><span class="n">casadi_int</span><span class="w"> </span><span class="o">*</span><span class="n">sz_iw</span><span class="p">,</span><span class="w"> </span><span class="n">casadi_int</span><span class="w"> </span><span class="o">*</span><span class="n">sz_w</span><span class="p">);</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">iir_filter_work_bytes</span><span class="p">(</span><span class="n">casadi_int</span><span class="w"> </span><span class="o">*</span><span class="n">sz_arg</span><span class="p">,</span><span class="w"> </span><span class="n">casadi_int</span><span class="o">*</span><span class="w"> </span><span class="n">sz_res</span><span class="p">,</span><span class="w"> </span><span class="n">casadi_int</span><span class="w"> </span><span class="o">*</span><span class="n">sz_iw</span><span class="p">,</span><span class="w"> </span><span class="n">casadi_int</span><span class="w"> </span><span class="o">*</span><span class="n">sz_w</span><span class="p">);</span>
<span class="cp">#define iir_filter_SZ_ARG 7</span>
<span class="cp">#define iir_filter_SZ_RES 3</span>
<span class="cp">#define iir_filter_SZ_IW 0</span>
<span class="cp">#define iir_filter_SZ_W 27</span>
<span class="cp">#ifdef __cplusplus</span>
<span class="p">}</span><span class="w"> </span><span class="cm">/* extern &quot;C&quot; */</span>
<span class="cp">#endif</span>

</pre></div>
</div>
<p>As stated at the top of the file, this is auto-generated by the CasADi backend, which converts the C++ computational graph for our <code class="docutils literal notranslate"><span class="pre">iir_filter</span></code> function to efficient C code.</p>
<p>Let’s go through two important parts of this file in a little bit of detail.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef casadi_real</span>
<span class="cp">#define casadi_real double</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef casadi_int</span>
<span class="cp">#define casadi_int long long int</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>Here CasADi defines type aliases as determined by the configuration.  It can be helpful to override these on embedded systems with limited precision or memory capacity.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">iir_filter</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">casadi_real</span><span class="o">**</span><span class="w"> </span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="n">casadi_real</span><span class="o">**</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">casadi_int</span><span class="o">*</span><span class="w"> </span><span class="n">iw</span><span class="p">,</span><span class="w"> </span><span class="n">casadi_real</span><span class="o">*</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">mem</span><span class="p">);</span>
</pre></div>
</div>
<p>This is the main function call.  However, unlike the Python version, the arguments, results, and work arrays <code class="docutils literal notranslate"><span class="pre">iw</span></code> and <code class="docutils literal notranslate"><span class="pre">w</span></code> are passed as pointers.
Before we call this function, we have to properly allocate and initialize all of these.<br />
Much of the rest of the functions are helper routines for setting up this required memory.
However, in our case we will rely on “driver” code generated by Archimedes to handle all of this, so we won’t need to work with any of it directly.</p>
<p>We can take a look at the actual <code class="docutils literal notranslate"><span class="pre">iir_filter</span></code> implementation in the <code class="docutils literal notranslate"><span class="pre">iir_filter.c</span></code> file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">extract_c_function</span><span class="p">(</span><span class="s2">&quot;iir_filter.c&quot;</span><span class="p">,</span> <span class="s2">&quot;iir_filter&quot;</span><span class="p">)</span>
<span class="n">extract_c_function</span><span class="p">(</span><span class="s2">&quot;iir_filter.c&quot;</span><span class="p">,</span> <span class="s2">&quot;casadi_f0&quot;</span><span class="p">)</span>
<span class="n">extract_c_function</span><span class="p">(</span><span class="s2">&quot;iir_filter.c&quot;</span><span class="p">,</span> <span class="s2">&quot;casadi_dot&quot;</span><span class="p">)</span>
<span class="n">extract_c_function</span><span class="p">(</span><span class="s2">&quot;iir_filter.c&quot;</span><span class="p">,</span> <span class="s2">&quot;casadi_copy&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">CASADI_SYMBOL_EXPORT</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">iir_filter</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">casadi_real</span><span class="o">**</span><span class="w"> </span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="n">casadi_real</span><span class="o">**</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">casadi_int</span><span class="o">*</span><span class="w"> </span><span class="n">iw</span><span class="p">,</span><span class="w"> </span><span class="n">casadi_real</span><span class="o">*</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">mem</span><span class="p">){</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">casadi_f0</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">iw</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">mem</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">casadi_f0</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">casadi_real</span><span class="o">**</span><span class="w"> </span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="n">casadi_real</span><span class="o">**</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">casadi_int</span><span class="o">*</span><span class="w"> </span><span class="n">iw</span><span class="p">,</span><span class="w"> </span><span class="n">casadi_real</span><span class="o">*</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">mem</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">casadi_real</span><span class="w"> </span><span class="o">*</span><span class="n">rr</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">ss</span><span class="p">;</span>
<span class="w">    </span><span class="n">casadi_real</span><span class="w"> </span><span class="o">*</span><span class="n">w0</span><span class="o">=</span><span class="n">w</span><span class="o">+</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">w1</span><span class="o">=</span><span class="n">w</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">w2</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">w3</span><span class="o">=</span><span class="n">w</span><span class="o">+</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">w4</span><span class="o">=</span><span class="n">w</span><span class="o">+</span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">w5</span><span class="o">=</span><span class="n">w</span><span class="o">+</span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">w6</span><span class="o">=</span><span class="n">w</span><span class="o">+</span><span class="mi">22</span><span class="p">,</span><span class="w"> </span><span class="n">w7</span><span class="p">;</span>
<span class="w">    </span><span class="n">casadi_copy</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">w0</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">ss</span><span class="o">=</span><span class="n">w0</span><span class="o">+</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ss</span><span class="o">!=</span><span class="n">w0</span><span class="o">+</span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">ss</span><span class="o">+=</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">rr</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">ss</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="n">w0</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ss</span><span class="o">=</span><span class="n">w1</span><span class="p">;</span><span class="w"> </span><span class="n">rr</span><span class="o">!=</span><span class="n">w0</span><span class="o">+</span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">rr</span><span class="o">+=</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">rr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">ss</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="n">w2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="n">w0</span><span class="o">+</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">ss</span><span class="o">=</span><span class="p">(</span><span class="o">&amp;</span><span class="n">w2</span><span class="p">);</span><span class="w"> </span><span class="n">rr</span><span class="o">!=</span><span class="n">w0</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">rr</span><span class="o">+=</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">rr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">ss</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="n">casadi_copy</span><span class="p">(</span><span class="n">w0</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">    </span><span class="n">casadi_copy</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">w1</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="n">w3</span><span class="p">,</span><span class="w"> </span><span class="n">ss</span><span class="o">=</span><span class="n">w1</span><span class="o">+</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ss</span><span class="o">!=</span><span class="n">w1</span><span class="o">+</span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">ss</span><span class="o">+=</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">rr</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">ss</span><span class="p">;</span>
<span class="w">    </span><span class="n">casadi_copy</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">w4</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="n">w4</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ss</span><span class="o">=</span><span class="n">w3</span><span class="p">;</span><span class="w"> </span><span class="n">rr</span><span class="o">!=</span><span class="n">w4</span><span class="o">+</span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">rr</span><span class="o">+=</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">rr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">ss</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="n">casadi_copy</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">w5</span><span class="p">);</span>
<span class="w">    </span><span class="n">w2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">casadi_dot</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">w5</span><span class="p">,</span><span class="w"> </span><span class="n">w0</span><span class="p">);</span>
<span class="w">    </span><span class="n">casadi_copy</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">w5</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="n">w6</span><span class="p">,</span><span class="w"> </span><span class="n">ss</span><span class="o">=</span><span class="n">w5</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">ss</span><span class="o">!=</span><span class="n">w5</span><span class="o">+</span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">ss</span><span class="o">+=</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">rr</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">ss</span><span class="p">;</span>
<span class="w">    </span><span class="n">w7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">casadi_dot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">w6</span><span class="p">,</span><span class="w"> </span><span class="n">w1</span><span class="p">);</span>
<span class="w">    </span><span class="n">w2</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">w7</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="p">(</span><span class="o">&amp;</span><span class="n">w7</span><span class="p">),</span><span class="w"> </span><span class="n">ss</span><span class="o">=</span><span class="n">w5</span><span class="o">+</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ss</span><span class="o">!=</span><span class="n">w5</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">ss</span><span class="o">+=</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">rr</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">ss</span><span class="p">;</span>
<span class="w">    </span><span class="n">w2</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">w7</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">rr</span><span class="o">=</span><span class="n">w4</span><span class="o">+</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">ss</span><span class="o">=</span><span class="p">(</span><span class="o">&amp;</span><span class="n">w2</span><span class="p">);</span><span class="w"> </span><span class="n">rr</span><span class="o">!=</span><span class="n">w4</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">rr</span><span class="o">+=</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">rr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">ss</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="n">casadi_copy</span><span class="p">(</span><span class="n">w4</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">casadi_real</span><span class="w"> </span><span class="nf">casadi_dot</span><span class="p">(</span><span class="n">casadi_int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">casadi_real</span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">casadi_real</span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">casadi_int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">  </span><span class="n">casadi_real</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="o">++</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="o">++</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">casadi_copy</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">casadi_real</span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">casadi_int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">casadi_real</span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">casadi_int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A few things to note about this implementation:</p>
<ul class="simple">
<li><p><strong>Static allocation</strong>: The generated code uses pre-allocated workspace memory instead of dynamic memory allocation, meaning no heap usage.</p></li>
<li><p><strong>Deterministic memory</strong>: Requirements can be precisely calculated at compile time.</p></li>
<li><p><strong>Fixed-Size Arrays</strong>: All array dimensions are determined at code generation time, ensuring predictable memory usage regardless of input data.</p></li>
<li><p><strong>No external dependencies</strong>: The generated code is self-contained, simplifying the build process for deployment.</p></li>
</ul>
<p>In brief:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Python code</p></th>
<th class="head"><p>Generated C code</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Dynamic memory allocation</p></td>
<td><p>Fixed, pre-allocated arrays</p></td>
</tr>
<tr class="row-odd"><td><p>High-level array operations</p></td>
<td><p>Low-level pointer manipulation</p></td>
</tr>
<tr class="row-even"><td><p>Readable control flow</p></td>
<td><p>Optimized computational structure</p></td>
</tr>
<tr class="row-odd"><td><p>Generic function for any filter order</p></td>
<td><p>Specialized for specific dimensions</p></td>
</tr>
</tbody>
</table>
</div>
<p>These details are critical for real-time and embedded applications.
However, the price for this efficiency is that the implementation hardly resembles the original Python algorithm.
This is why the automatic code generation paradigm is so helpful; the high-level algorithm can be modified in Python without the need for time-intensive re-coding the low-level C implementation.</p>
<p>However, at this point we still have quite a bit of work ahead of us.
In particular, we still need to:</p>
<ol class="arabic simple">
<li><p>Create arrays for arguments, results, and working memory</p></li>
<li><p>Map these to the pointers expected by the <code class="docutils literal notranslate"><span class="pre">iir_filter</span></code> implementation</p></li>
<li><p>Initialize the arrays correctly</p></li>
</ol>
<p>If you examine the source code more carefully, you might even be surprised to see that the filter coefficients aren’t even stored in the C code.
We could of course use these as global variables in Python, which would effectively “hardcode” the filter coefficients into the generated C code, but it is cleaner and more maintainable to separate the coeffients from the actual filter implementation.</p>
<p>This is where Archimedes builds on CasADi’s powerful capabilities with its templated “driver” code generation system.
In the next part of the tutorial we’ll begin to explore this by auto-generating a plain-C “main” function.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="deployment02.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Generating driver code</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../../../notebooks/deployment/deployment00.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Deploying to Hardware</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Pine Tree Labs, LLC
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Generating C code</a><ul>
<li><a class="reference internal" href="#python-implementation">Python implementation</a></li>
<li><a class="reference internal" href="#converting-to-c-code">Converting to C code</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>